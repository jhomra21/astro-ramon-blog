---
import HeaderLink from './HeaderLink.astro';
import { SITE_TITLE } from '../consts';
import TypewriterEffect from './TypewriterEffect.astro';
import WeatherWidget from './WeatherWidget';
---

<header>
	<div class="progress-bar" id="scroll-progress"></div>
	<nav class="max-w-[1120px] mx-auto px-4">
		<h2>
			<a href="/" class="font-mono">
				<TypewriterEffect text={SITE_TITLE} />
			</a>
		</h2>
		<div class="flex items-center">
			<WeatherWidget client:load />
			<div class="h-6 w-px bg-neutral-200 mx-4" />
			<div class="internal-links font-mono tracking-tight" id="nav-links">
				<HeaderLink href="/">home</HeaderLink>
				<HeaderLink href="/about">about</HeaderLink>
				<HeaderLink href="https://3d-globe-iss-tracker.pages.dev" target="_blank">iss tracker</HeaderLink>
				<HeaderLink href="https://vidtogifconverter.pages.dev" target="_blank">video to gif</HeaderLink>
			</div>
		</div>
	</nav>
</header>

<style>
	header {
		margin: 0;
		padding: 0.75em 0;
		background-color: white;
		position: sticky;
		top: 0;
		z-index: 100;
		border-bottom: 1px solid rgba(0, 0, 0, 0.06);
	}

	.progress-bar {
		position: absolute;
		top: 0;
		left: 0;
		height: 1px;
		background: rgba(0, 0, 0, 0.1);
		width: 0%;
		transition: width 0.1s ease-in-out;
	}

	h2 {
		margin: 0;
		font-size: 1em;
	}

	nav {
		display: flex;
		align-items: center;
		justify-content: space-between;
		font-family: 'JetBrains Mono', monospace;
	}

	nav a {
		color: rgba(0, 0, 0, 0.75);
		text-decoration: none;
		font-size: 0.9rem;
		padding: 0.4em 0.8em;
		border: 1px solid transparent;
		transition: all 0.15s ease;
		letter-spacing: -0.025em;
		font-weight: 450;
	}

	nav a:hover {
		background: rgba(0, 0, 0, 0.02);
		border: 1px solid rgba(0, 0, 0, 0.06);
		text-decoration: none;
	}

	nav a.active {
		background: rgba(0, 0, 0, 0.02);
		border: 1px solid rgba(0, 0, 0, 0.06);
	}

	nav a.muted {
		opacity: 0.5;
	}

	.internal-links {
		display: flex;
		gap: 0.5em;
	}

	nav a.text-xl {
		font-size: 1rem !important;
		font-weight: 500 !important;
	}

	nav a.font-bold {
		font-weight: 600 !important;
	}
</style>

<script>
	const navLinks = document.querySelectorAll('#nav-links a');
	const siteTitle = document.querySelector('h2 a');
	const currentPath = window.location.pathname;

	function handleScroll() {
		const progressBar = document.getElementById('scroll-progress');
		if (progressBar) {
			const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
			const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
			const scrolled = (winScroll / height) * 100;
			progressBar.style.width = scrolled + '%';
		}

		const scrollPosition = window.scrollY;
		const isAtTop = scrollPosition < 100;
		
		if (isAtTop) {
			navLinks.forEach(link => {
				link.classList.remove('muted', 'text-xl', 'font-bold');
			});
			siteTitle?.classList.remove('text-2xl', 'font-bold');
			return;
		}

		navLinks.forEach(link => {
			const currentPathSegment = currentPath.split('/')[1];
			const href = link.getAttribute('href');
			const isCurrentPage = href === currentPath || (currentPathSegment && href === '/' + currentPathSegment);
			
			if (isCurrentPage) {
				link.classList.add('text-xl', 'font-bold');
				link.classList.remove('muted');
			} else {
				link.classList.add('muted');
				link.classList.remove('text-xl', 'font-bold');
			}
		});

		siteTitle?.classList.add('text-2xl', 'font-bold');
	}

	document.addEventListener('DOMContentLoaded', () => {
		window.addEventListener('scroll', handleScroll);
		handleScroll();
	});
</script>
